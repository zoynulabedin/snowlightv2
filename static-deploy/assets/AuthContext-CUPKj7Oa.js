import{r as o,j as y}from"./index-BJHAE5s4.js";const i=o.createContext(void 0);function A({children:n}){const[l,s]=o.useState(null),[d,f]=o.useState(!0),u=async()=>{try{const e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){const r=await e.json();s(r.user)}else s(null)}catch(e){console.error("Auth check failed:",e),s(null)}finally{f(!1)}};o.useEffect(()=>{u()},[]);const h=async(e,r)=>{try{const t=new FormData;t.append("email",e),t.append("password",r);const c=await(await fetch("/api/auth/login",{method:"POST",body:t,credentials:"include"})).json();return c.success?(s(c.user),{success:!0}):{success:!1,error:c.error}}catch(t){return console.error("Login failed:",t),{success:!1,error:"Network error occurred"}}},p=async e=>{try{const r=new FormData;r.append("email",e.email),r.append("username",e.username),r.append("password",e.password),e.name&&r.append("name",e.name);const a=await(await fetch("/api/auth/signup",{method:"POST",body:r,credentials:"include"})).json();return a.success?(s(a.user),{success:!0}):{success:!1,error:a.error}}catch(r){return console.error("Signup failed:",r),{success:!1,error:"Network error occurred"}}},m=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),s(null)}catch(e){console.error("Logout failed:",e),s(null)}},w=async()=>{await u()};return y.jsx(i.Provider,{value:{user:l,isLoading:d,login:h,signup:p,logout:m,refreshUser:w},children:n})}function g(){const n=o.useContext(i);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}export{A,g as u};
